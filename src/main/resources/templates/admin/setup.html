<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Administration Setup - Store</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
    <div class="container mt-5">
        <div class="d-flex justify-content-between align-items-center">
            <h1>Administration Setup</h1>
            <a href="/logout" class="btn btn-outline-danger btn-sm">Logout</a>
        </div>

        <ul class="nav nav-tabs" id="setupTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="company-tab" data-bs-toggle="tab" data-bs-target="#company"
                    type="button" role="tab">Companies</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="store-tab" data-bs-toggle="tab" data-bs-target="#store" type="button"
                    role="tab">Stores</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="user-tab" data-bs-toggle="tab" data-bs-target="#user" type="button"
                    role="tab">Users</button>
            </li>
            <li class="nav-item">
                <a class="nav-link text-primary fw-bold" href="/stock">Stock Management â†’</a>
            </li>
        </ul>

        <div class="tab-content mt-3" id="setupContent">
            <!-- Company Tab -->
            <div class="tab-pane fade show active" id="company" role="tabpanel">
                <h3>Add Company</h3>
                <form method="post" th:action="@{/admin/setup/company}" th:object="${company}">
                    <input type="hidden" id="companyId" name="id" />
                    <div class="mb-3">
                        <label for="companyName" class="form-label">Name</label>
                        <input type="text" class="form-control" id="companyName" name="name" th:field="*{name}">
                    </div>
                    <button type="submit" class="btn btn-primary">Save</button>
                </form>

                <h4 class="mt-4">Existing Companies</h4>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="comp : ${companies}">
                            <td th:text="${comp.id}"></td>
                            <td th:text="${comp.name}"></td>
                            <td>
                                <button class="btn btn-sm btn-warning"
                                    th:onclick="editCompany([[${comp.id}]], [[${comp.name}]])">Edit</button>
                                <form th:action="@{/admin/setup/company/delete/{id}(id=${comp.id})}" method="post"
                                    style="display:inline;">
                                    <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                                </form>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Store Tab -->
            <div class="tab-pane fade" id="store" role="tabpanel">
                <h3>Add Store</h3>
                <form method="post" th:action="@{/admin/setup/store}" th:object="${store}">
                    <input type="hidden" id="storeId" name="id" />
                    <div class="mb-3">
                        <label for="storeName" class="form-label">Name</label>
                        <input type="text" class="form-control" id="storeName" name="name" th:field="*{name}">
                    </div>
                    <div class="mb-3">
                        <label for="storeLocation" class="form-label">Location</label>
                        <input type="text" class="form-control" id="storeLocation" name="location"
                            th:field="*{location}">
                    </div>
                    <button type="submit" class="btn btn-primary">Save</button>
                </form>

                <h4 class="mt-4">Existing Stores</h4>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Location</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="st : ${stores}">
                            <td th:text="${st.id}"></td>
                            <td th:text="${st.name}"></td>
                            <td th:text="${st.location}"></td>
                            <td>
                                <button class="btn btn-sm btn-warning"
                                    th:onclick="editStore([[${st.id}]], [[${st.name}]], [[${st.location}]])">Edit</button>
                                <form th:action="@{/admin/setup/store/delete/{id}(id=${st.id})}" method="post"
                                    style="display:inline;">
                                    <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                                </form>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- User Tab -->
            <div class="tab-pane fade" id="user" role="tabpanel">
                <h3>Add User</h3>
                <form method="post" th:action="@{/admin/setup/user}" th:object="${user}">
                    <input type="hidden" id="userId" name="id" />
                    <div class="mb-3">
                        <label for="username" class="form-label">Username</label>
                        <input type="text" class="form-control" id="username" name="username" th:field="*{username}">
                    </div>
                    <div class="mb-3">
                        <label for="password" class="form-label">Password</label>
                        <input type="password" class="form-control" id="password" name="password"
                            th:field="*{password}">
                        <div class="form-text">Leave blank to keep existing password when editing.</div>
                    </div>
                    <div class="mb-3">
                        <label for="role" class="form-label">Role</label>
                        <select class="form-select" id="role" name="role">
                            <option value="">Select Role</option>
                            <!-- Hardcoded roles as per Role enum -->
                            <option value="ADMIN">ADMIN</option>
                            <option value="COMPANY_ADMIN">COMPANY_ADMIN</option>
                            <option value="STORE_USER">STORE_USER</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="userCompany" class="form-label">Company</label>
                        <select class="form-select" id="userCompany" name="companyId">
                            <option value="">Select Company</option>
                            <option th:each="comp : ${companies}" th:value="${comp.id}" th:text="${comp.name}"></option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="userStore" class="form-label">Store</label>
                        <select class="form-select" id="userStore" name="storeId">
                            <option value="">Select Store</option>
                            <option th:each="st : ${stores}" th:value="${st.id}" th:text="${st.name}"></option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary">Save</button>
                </form>

                <h4 class="mt-4">Existing Users</h4>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Username</th>
                            <th>Role</th>
                            <th>Company</th>
                            <th>Store</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="u : ${users}">
                            <td th:text="${u.id}"></td>
                            <td th:text="${u.username}"></td>
                            <td th:text="${u.role}"></td>
                            <td th:text="${u.company != null ? u.company.name : '-'}"></td>
                            <td th:text="${u.store != null ? u.store.name : '-'}"></td>
                            <td>
                                <button class="btn btn-sm btn-warning"
                                    th:onclick="editUser([[${u.id}]], [[${u.username}]], [[${u.role}]], [[${u.company?.id}]], [[${u.store?.id}]])">Edit</button>
                                <form th:action="@{/admin/setup/user/delete/{id}(id=${u.id})}" method="post"
                                    style="display:inline;">
                                    <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                                </form>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

        </div>
    </div>

    <script>
        function editCompany(id, name) {
            document.getElementById('companyId').value = id;
            document.getElementById('companyName').value = name;
        }
        function editStore(id, name, location) {
            document.getElementById('storeId').value = id;
            document.getElementById('storeName').value = name;
            document.getElementById('storeLocation').value = location;
        }
        function editUser(id, username, role, companyId, storeId) {
            document.getElementById('userId').value = id;
            document.getElementById('username').value = username;
            document.getElementById('role').value = role || '';
            document.getElementById('userCompany').value = companyId || '';
            document.getElementById('userStore').value = storeId || '';
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>