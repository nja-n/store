<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head th:replace="~{fragments :: head('My Profile')}"></head>

<body>
    <header th:replace="~{fragments :: header('My Account', 'Update your personal settings')}"></header>

    <div class="container mb-5">
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="card shadow-sm border-0 rounded-4">
                    <div class="card-body p-4">
                        <div th:if="${param.success}" class="alert alert-success">
                            Profile updated successfully!
                        </div>

                        <form th:action="@{/profile/update}" method="post">
                            <div class="mb-3 text-center">
                                <div class="icon-box mb-2" style="width: 80px; height: 80px; font-size: 2rem;">USR</div>
                                <h4 th:text="${user.username}" class="fw-bold mb-0">Username</h4>
                                <p class="text-muted small" th:text="${user.role}">ROLE</p>
                            </div>

                            <hr class="my-4">

                            <div class="mb-3">
                                <label class="form-label fw-600">Username</label>
                                <input type="text" class="form-control" name="username" th:value="${user.username}"
                                    required>
                            </div>

                            <div class="mb-3">
                                <label class="form-label fw-600">New Password</label>
                                <input type="password" class="form-control" name="password"
                                    placeholder="Leave blank to keep current">
                            </div>

                            <div th:if="${user.company != null}" class="mb-3">
                                <label class="form-label text-muted small">Associated Company</label>
                                <input type="text" class="form-control bg-light" th:value="${user.company.name}"
                                    readonly disabled>
                            </div>

                            <div th:if="${user.store != null}" class="mb-3">
                                <label class="form-label text-muted small">Assigned Store</label>
                                <input type="text" class="form-control bg-light" th:value="${user.store.name}" readonly
                                    disabled>
                            </div>

                            <button type="submit" class="btn btn-primary w-100 py-2 mt-3 fw-bold">Update
                                Profile</button>
                            <a th:if="${#authorization.expression('hasRole(''ADMIN'') or hasRole(''COMPANY_ADMIN'')')}"
                                th:href="${#authorization.expression('hasRole(''ADMIN'')')} ? '/admin/setup' : '/setup'"
                                class="btn btn-outline-secondary w-100 py-2 mt-2 fw-bold">Go to
                                Setup</a>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer th:replace="~{fragments :: footer}"></footer>
</body>

</html>